<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dashboard Completo - Sistema de Gestión</title>
  <style>
    /* CSS Variables */
    :root {
      --color-bg: #ffffff;
      --color-text-base: #6b7280;
      --color-text-heading: #111827;
      --color-primary: #111827;
      --color-primary-hover: #374151;
      --color-card-bg: #f9fafb;
      --color-shadow: rgba(0, 0, 0, 0.05);
      --sidebar-width: 280px;
      --sidebar-collapsed-width: 72px;
      --transition-speed: 0.3s;
      --border-radius: 0.75rem; /* 12px */
      --font-family:
        'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto,
        Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    }

    /* Reset and base */
    *, *::before, *::after {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: var(--font-family);
      background: var(--color-bg);
      color: var(--color-text-base);
      line-height: 1.5;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    a {
      color: var(--color-primary);
      text-decoration: none;
      transition: color var(--transition-speed) ease;
    }
    a:hover,
    a:focus {
      color: var(--color-primary-hover);
      outline: none;
    }

    /* Header Navigation */
    header {
      position: sticky;
      top: 0;
      background: #ffffff;
      border-bottom: 1px solid #e5e7eb;
      z-index: 1001;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 2rem;
      height: 60px;
      box-shadow: 0 1px 6px var(--color-shadow);
    }

    .logo {
      font-weight: 700;
      font-size: 1.5rem;
      color: var(--color-primary);
      user-select: none;
    }

    nav.nav-links {
      display: flex;
      gap: 1.5rem;
      font-weight: 600;
      font-size: 1rem;
      color: var(--color-text-base);
    }

    nav.nav-links a {
      padding: 0.25rem 0.5rem;
      border-radius: 6px;
    }

    nav.nav-links a:hover,
    nav.nav-links a:focus {
      background-color: #f3f4f6;
      color: var(--color-primary-hover);
    }

    /* Layout wrapper */
    .container {
      display: flex;
      flex: 1;
      max-width: 1200px;
      margin: 2rem auto 3rem;
      width: 100%;
      gap: 2rem;
      padding: 0 1rem;
    }

    /* Sidebar styling */
    aside.sidebar {
      background-color: var(--color-card-bg);
      border-radius: var(--border-radius);
      width: var(--sidebar-width);
      min-height: calc(100vh - 96px); /* header + margin */
      box-shadow: 0 2px 6px var(--color-shadow);
      display: flex;
      flex-direction: column;
      padding: 1rem 1rem 2rem;
      position: sticky;
      top: 60px;
      transition: width var(--transition-speed) ease;
      overflow-y: auto;
    }

    aside.sidebar.collapsed {
      width: var(--sidebar-collapsed-width);
    }

    /* Scrollbar for sidebar */
    aside.sidebar::-webkit-scrollbar {
      width: 8px;
    }
    aside.sidebar::-webkit-scrollbar-thumb {
      background: #d1d5db;
      border-radius: 10px;
    }
    aside.sidebar::-webkit-scrollbar-thumb:hover {
      background: #9ca3af;
    }

    /* Sidebar Toggle Button */
    #toggleBtn {
      background: none;
      border: none;
      font-size: 1.5rem;
      line-height: 1;
      cursor: pointer;
      padding: 0.25rem 0.5rem;
      color: var(--color-primary);
      user-select: none;
      align-self: flex-start;
      margin-bottom: 0.75rem;
      transition: transform var(--transition-speed) ease;
      border-radius: 8px;
    }
    #toggleBtn:hover,
    #toggleBtn:focus {
      background-color: #e5e7eb;
      outline: none;
    }
    aside.sidebar.collapsed #toggleBtn {
      transform: rotate(90deg);
    }

    #menu-title {
      font-size: 1.25rem;
      font-weight: 700;
      margin-bottom: 1rem;
      color: var(--color-primary);
      user-select: none;
      white-space: nowrap;
      transition: opacity 0.3s ease;
    }
    aside.sidebar.collapsed #menu-title {
      opacity: 0;
      pointer-events: none;
      height: 0;
      margin: 0;
      overflow: hidden;
    }

    /* Menu Items */
    .menu-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-weight: 600;
      font-size: 1rem;
      color: var(--color-primary);
      padding: 0.6rem 0.75rem;
      margin-bottom: 0.25rem;
      border-radius: 8px;
      cursor: pointer;
      user-select: none;
      transition: background-color var(--transition-speed) ease;
      white-space: nowrap;
    }
    .menu-item:hover,
    .menu-item:focus {
      background-color: #e5e7eb;
      outline: none;
    }
    aside.sidebar.collapsed .menu-item span.arrow {
      display: none;
    }

    /* Arrow icon with CSS */
    .arrow {
      display: inline-block;
      width: 10px;
      height: 10px;
      border-right: 2.5px solid var(--color-primary);
      border-bottom: 2.5px solid var(--color-primary);
      transform: rotate(45deg);
      transition: transform 0.3s ease;
      margin-left: 0.5rem;
      flex-shrink: 0;
      user-select: none;
    }
    .submenu.open + .menu-item > .arrow,
    .menu-item[aria-expanded="true"] > .arrow {
      transform: rotate(-135deg);
    }

    /* Submenu */
    .submenu {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease, padding 0.3s ease;
      padding-left: 1rem;
      margin-bottom: 1rem;
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
      font-size: 0.95rem;
      color: var(--color-primary-hover);
      user-select: none;
    }
    .submenu.open {
      max-height: 600px; /* Large enough to show all items */
      padding-top: 0.25rem;
      padding-bottom: 0.25rem;
    }
    aside.sidebar.collapsed .submenu {
      display: none !important;
    }

    /* Submenu Items */
    .submenu-item {
      padding: 0.4rem 0.75rem;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color var(--transition-speed) ease;
      user-select: none;
      white-space: nowrap;
      color: var(--color-primary);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .submenu-item:hover,
    .submenu-item:focus {
      background-color: #d1d5db;
      outline: none;
    }

    /* Icon for submenu items */
    .submenu-item svg {
      width: 18px;
      height: 18px;
      stroke: var(--color-primary);
      stroke-width: 1.5;
      fill: none;
      user-select: none;
      flex-shrink: 0;
    }

    /* Content */
    main.content {
      flex: 1;
      background: var(--color-bg);
      padding: 2rem;
      border-radius: var(--border-radius);
      box-shadow: 0 2px 6px var(--color-shadow);
      color: var(--color-text-base);
      transition: margin-left var(--transition-speed) ease;
      min-height: calc(100vh - 96px);
      max-width: 100%;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
    }
    /* When sidebar collapsed, add left margin adjustment if needed */
    .sidebar.collapsed ~ main.content {
      margin-left: var(--sidebar-collapsed-width);
    }

    /* Headings */
    main.content h1 {
      font-size: 3rem;
      font-weight: 700;
      color: var(--color-text-heading);
      margin: 0 0 1rem 0;
      user-select: none;
    }

    /* Form container */
    .form-container {
      background: var(--color-card-bg);
      border-radius: var(--border-radius);
      padding: 1.75rem 2rem;
      box-shadow: inset 0 0 10px rgba(0,0,0,0.03);
      min-height: 300px;
      color: var(--color-text-base);
      font-size: 1rem;
      line-height: 1.6;
      user-select: text;
      overflow-y: auto;
      margin-top: 2rem;
    }

    /* Dashboard Section */
    .dashboard {
      margin-bottom: 2rem;
      display: grid;
      grid-template-columns: repeat(auto-fit,minmax(240px,1fr));
      gap: 1.75rem;
    }
    .card {
      background: var(--color-card-bg);
      border-radius: var(--border-radius);
      padding: 1.5rem 2rem;
      box-shadow: 0 4px 8px var(--color-shadow);
      color: var(--color-text-heading);
      user-select: none;
      display: flex;
      flex-direction: column;
      justify-content: center;
      transition: box-shadow 0.3s ease, transform 0.3s ease;
    }
    .card:hover,
    .card:focus-within {
      box-shadow: 0 8px 14px rgba(0,0,0,0.12);
      transform: translateY(-4px);
      outline: none;
    }
    .card h3 {
      font-size: 1.5rem;
      font-weight: 700;
      margin: 0 0 0.5rem 0;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .card .metric {
      font-size: 2.5rem;
      font-weight: 800;
      color: var(--color-primary-hover);
      letter-spacing: 0.03em;
    }
    .card svg {
      width: 36px;
      height: 36px;
      stroke: var(--color-primary-hover);
      stroke-width: 1.5;
      fill: none;
      user-select: none;
    }

    /* Table styles */
    table.data-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 1rem;
    }
    table.data-table thead {
      background-color: #e5e7eb;
    }
    table.data-table th,
    table.data-table td {
      text-align: left;
      padding: 0.5rem 0.75rem;
      border-bottom: 1px solid #d1d5db;
    }
    table.data-table tbody tr:hover {
      background-color: #f9fafb;
    }
    table.data-table caption {
      caption-side: top;
      font-weight: 700;
      font-size: 1.25rem;
      margin-bottom: 1rem;
      color: var(--color-primary);
    }
    /* Responsive */
    @media (max-width: 768px) {
      aside.sidebar {
        position: fixed;
        top: 60px;
        left: 0;
        height: calc(100vh - 60px);
        z-index: 1002;
        transform: translateX(0);
        transition: transform var(--transition-speed) ease;
      }
      aside.sidebar.collapsed {
        transform: translateX(-100%);
      }
      .container {
        margin: 1rem auto;
        flex-direction: column;
      }
      main.content {
        min-height: auto;
        margin-top: 1rem;
      }
      .dashboard {
        grid-template-columns: 1fr;
      }
    }

    /* Button styles */
    button {
      background-color: var(--color-primary);
      color: #fff;
      border: none;
      border-radius: 0.5rem;
      padding: 0.6rem 1.25rem;
      font-weight: 700;
      font-size: 1rem;
      cursor: pointer;
      transition: background-color var(--transition-speed) ease;
      user-select: none;
    }
    button:hover,
    button:focus {
      background-color: var(--color-primary-hover);
      outline: none;
    }

    /* Input and select */
    input[type="text"],
    input[type="email"],
    input[type="tel"],
    input[type="date"],
    input[type="number"],
    select {
      width: 100%;
      padding: 0.5rem 0.75rem;
      margin-top: 0.25rem;
      margin-bottom: 1rem;
      border: 1px solid #d1d5db;
      border-radius: 0.5rem;
      font-size: 1rem;
      transition: border-color var(--transition-speed) ease;
      box-sizing: border-box;
    }
    input[type="text"]:focus,
    input[type="email"]:focus,
    input[type="tel"]:focus,
    input[type="date"]:focus,
    input[type="number"]:focus,
    select:focus {
      border-color: var(--color-primary);
      outline: none;
    }

    /* Form labels */
    label {
      font-weight: 600;
      color: var(--color-primary);
      user-select: none;
    }

    /* Validation highlight (simple) */
    input:invalid,
    select:invalid {
      border-color: #dc2626;
    }
  </style>
</head>
<body>
  <header>
    <div class="logo" aria-label="Logo del Sistema">Gestión</div>
    <nav class="nav-links" role="navigation" aria-label="Navegación principal">
      <a href="#" tabindex="0">Inicio</a>
      <a href="#" tabindex="0">Reportes</a>
      <a href="#" tabindex="0">Configuración</a>
    </nav>
  </header>

  <div class="container">
    <aside class="sidebar" id="sidebar" aria-label="Menú lateral de navegación">
      <button id="toggleBtn" title="Expandir o colapsar menú" aria-expanded="true" aria-controls="sidebar">
        ☰
      </button>
      <h2 id="menu-title">Menú</h2>

      <nav role="menubar" aria-label="Menú principal">
        <div class="menu-item" role="menuitem" tabindex="0" aria-expanded="false" aria-controls="clientes" data-target="clientes">
          <!-- Icon: Users -->
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false" viewBox="0 0 24 24"><path d="M17 21v-2a4 4 0 0 0-3-3.87"></path><path d="M9 19v-2a4 4 0 0 1 3-3.87"></path><circle cx="12" cy="7" r="4"></circle></svg>
          Clientes <span class="arrow"></span>
        </div>
        <div class="submenu" id="clientes" role="menu" aria-hidden="true">
          <div class="submenu-item" role="menuitem" tabindex="0" data-form="add-client">
            <svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 24 24"><circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg>
            Agregar Cliente
          </div>
          <div class="submenu-item" role="menuitem" tabindex="0" data-form="add-sale">
            <svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 24 24"><path d="M20 6L9 17l-5-5" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg>
            Registrar Venta
          </div>
          <div class="submenu-item" role="menuitem" tabindex="0" data-form="add-payment">
            <svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 24 24"><path d="M12 5v14M7 10h10" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg>
            Agregar Cobro
          </div>
        </div>

        <div class="menu-item" role="menuitem" tabindex="0" aria-expanded="false" aria-controls="proveedores" data-target="proveedores">
          <!-- Icon: Truck -->
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false" viewBox="0 0 24 24"><rect x="1" y="3" width="15" height="13"></rect><polygon points="16 8 20 8 23 11 23 16 16 16 16 8"></polygon><circle cx="5.5" cy="18.5" r="2.5"></circle><circle cx="18.5" cy="18.5" r="2.5"></circle></svg>
          Proveedores <span class="arrow"></span>
        </div>
        <div class="submenu" id="proveedores" role="menu" aria-hidden="true">
          <div class="submenu-item" role="menuitem" tabindex="0" data-form="add-provider">
            <svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" stroke="currentColor" stroke-width="2" fill="none" stroke-linejoin="round"/></svg>
            Agregar Proveedor
          </div>
          <div class="submenu-item" role="menuitem" tabindex="0" data-form="add-purchase">
            <svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 24 24"><path d="M12 20v-6M6 12v-2h6v2" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg>
            Registrar Compra
          </div>
          <div class="submenu-item" role="menuitem" tabindex="0" data-form="add-expense">
            <svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 24 24"><path d="M12 5v14M7 10h10" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg>
            Agregar Pago
          </div>
        </div>

        <div class="menu-item" role="menuitem" tabindex="0" aria-expanded="false" aria-controls="productos" data-target="productos">
          <!-- Icon: Package -->
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false" viewBox="0 0 24 24"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline><line x1="12" y1="22.08" x2="12" y2="12"></line></svg>
          Productos <span class="arrow"></span>
        </div>
        <div class="submenu" id="productos" role="menu" aria-hidden="true">
          <div class="submenu-item" role="menuitem" tabindex="0" data-form="add-product">
            <svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 24 24"><rect x="3" y="8" width="18" height="6" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg>
            Agregar Producto
          </div>
          <div class="submenu-item" role="menuitem" tabindex="0" data-form="inventory-list">
            <svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 24 24"><path d="M3 14v3a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-3" stroke="currentColor" stroke-width="2" fill="none" stroke-linejoin="round"/></svg>
            Control Stock
          </div>
        </div>

        <div class="menu-item" role="menuitem" tabindex="0" aria-expanded="false" aria-controls="cuentas" data-target="cuentas">
          <!-- Icon: Credit Card -->
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false" viewBox="0 0 24 24"><rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect><line x1="1" y1="10" x2="23" y2="10"></line></svg>
          Cuentas Contables <span class="arrow"></span>
        </div>
        <div class="submenu" id="cuentas" role="menu" aria-hidden="true">
          <div class="submenu-item" role="menuitem" tabindex="0" data-form="add-account">
            <svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" fill="none" stroke-linejoin="round"/></svg>
            Agregar Cuenta
          </div>
          <div class="submenu-item" role="menuitem" tabindex="0" data-form="list-accounts">
            <svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 24 24"><path d="M3 6h18M3 12h18M3 18h18" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg>
            Listado Cuentas
          </div>
        </div>

        <div class="menu-item" role="menuitem" tabindex="0" aria-expanded="false" aria-controls="estados" data-target="estados">
          <!-- Icon: Bar Chart -->
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false" viewBox="0 0 24 24"><line x1="12" y1="20" x2="12" y2="10"></line><line x1="18" y1="20" x2="18" y2="4"></line><line x1="6" y1="20" x2="6" y2="16"></line></svg>
          Estados Financieros <span class="arrow"></span>
        </div>
        <div class="submenu" id="estados" role="menu" aria-hidden="true">
          <div class="submenu-item" role="menuitem" tabindex="0" data-form="balance-general">
            <svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 24 24"><path d="M4 4h16v16H4z" stroke="currentColor" stroke-width="2" fill="none" stroke-linejoin="round"/></svg>
            Balance General
          </div>
          <div class="submenu-item" role="menuitem" tabindex="0" data-form="estado-resultados">
            <svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 24 24"><path d="M5 12h14M5 6h14M12 18h7" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg>
            Estado de Resultados
          </div>
          <div class="submenu-item" role="menuitem" tabindex="0" data-form="flujo-efectivo">
            <svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 24 24"><path d="M12 3v18M3 12h18" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg>
            Flujo de Efectivo
          </div>
          <div class="submenu-item" role="menuitem" tabindex="0" data-form="cambios-patrimonio">
            <svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 24 24"><path d="M3 7h18M3 12h18M12 17h9" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg>
            Cambios de Patrimonio
          </div>
        </div>
      </nav>
    </aside>

    <main class="content" role="main" tabindex="-1">
      <h1>Dashboard Completo</h1>

      <section class="dashboard" aria-label="Resumen de métricas financieras y operativas">
        <article class="card" tabindex="0" aria-label="Total de Clientes">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" >
            <circle cx="12" cy="7" r="4" />
            <path d="M5.5 21a6.5 6.5 0 0113 0" />
          </svg>
          <h3>Clientes</h3>
          <div class="metric" id="metric-clientes">0</div>
        </article>

        <article class="card" tabindex="0" aria-label="Total de Proveedores">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" >
            <rect x="4" y="7" width="16" height="10" rx="2" />
            <circle cx="12" cy="12" r="3" />
          </svg>
          <h3>Proveedores</h3>
          <div class="metric" id="metric-proveedores">0</div>
        </article>

        <article class="card" tabindex="0" aria-label="Productos en Stock">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" >
            <rect x="3" y="8" width="18" height="6" rx="2" ry="2" />
            <path d="M3 14v3a2 2 0 002 2h14a2 2 0 002-2v-3" />
          </svg>
          <h3>Productos en Stock</h3>
          <div class="metric" id="metric-productos">0</div>
        </article>

        <article class="card" tabindex="0" aria-label="Ventas Totales">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" >
            <path d="M4 4h16v16H4z" fill="none" />
            <path d="M9 17v-2a2 2 0 012-2h4" />
            <path d="M7 9l5 5" />
          </svg>
          <h3>Ventas Totales</h3>
          <div class="metric" id="metric-ventas">$ 0</div>
        </article>

        <article class="card" tabindex="0" aria-label="Compras Totales">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" >
            <path d="M21 12H3" />
            <path d="M12 3v18" />
          </svg>
          <h3>Compras Totales</h3>
          <div class="metric" id="metric-compras">$ 0</div>
        </article>

        <article class="card" tabindex="0" aria-label="Total Activos">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" >
            <circle cx="12" cy="12" r="10" />
            <path d="M16 8l-4 8-4-8" />
          </svg>
          <h3>Total Activos</h3>
          <div class="metric" id="metric-activos">$ 0</div>
        </article>
      </section>

      <section class="form-container" id="form-container" aria-live="polite" aria-relevant="additions">
        <p>Seleccione una opción del menú para comenzar.</p>
      </section>
    </main>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // -- Elements --
      const toggleBtn = document.getElementById('toggleBtn');
      const sidebar = document.getElementById('sidebar');
      const menuItems = sidebar.querySelectorAll('.menu-item');
      const submenuItems = sidebar.querySelectorAll('.submenu-item');
      const formContainer = document.getElementById('form-container');
      const dashboardMetrics = {
        clientes: document.getElementById('metric-clientes'),
        proveedores: document.getElementById('metric-proveedores'),
        productos: document.getElementById('metric-productos'),
        ventas: document.getElementById('metric-ventas'),
        compras: document.getElementById('metric-compras'),
        activos: document.getElementById('metric-activos'),
      };

      // -- Data storage keys --
      const STORAGE_KEYS = {
        clientes: 'gestion-clientes',
        proveedores: 'gestion-proveedores',
        productos: 'gestion-productos',
        cuentas: 'gestion-cuentas',
        ventas: 'gestion-ventas',
        compras: 'gestion-compras',
        cobros: 'gestion-cobros',
        pagos: 'gestion-pagos',
      };

      // -- Initialize data --
      let data = {
        clientes: [],
        proveedores: [],
        productos: [],
        cuentas: [],
        ventas: [],
        compras: [],
        cobros: [],
        pagos: []
      };

      // Load data from localStorage
      function loadData(){
        Object.keys(STORAGE_KEYS).forEach(key => {
          const stored = localStorage.getItem(STORAGE_KEYS[key]);
          data[key] = stored ? JSON.parse(stored) : [];
        });
      }

      // Save data to localStorage
      function saveData(){
        Object.keys(STORAGE_KEYS).forEach(key => {
          localStorage.setItem(STORAGE_KEYS[key], JSON.stringify(data[key]));
        });
      }

      // Update dashboard metrics based on data
      function updateDashboard(){
        dashboardMetrics.clientes.textContent = data.clientes.length;
        dashboardMetrics.proveedores.textContent = data.proveedores.length;
        dashboardMetrics.productos.textContent = data.productos.reduce((acc, p) => acc + (p.stock || 0), 0);
        const totalVentas = data.ventas.reduce((acc,v) => acc + v.monto, 0);
        const totalCompras = data.compras.reduce((acc,c) => acc + c.monto, 0);
        dashboardMetrics.ventas.textContent = `$ ${totalVentas.toFixed(2)}`;
        dashboardMetrics.compras.textContent = `$ ${totalCompras.toFixed(2)}`;
        // Total activos: sum productos stock value + cuentas activos (simulate)
        const activosProductos = data.productos.reduce((acc,p) => acc + (p.stock || 0) * (p.precio || 0), 0);
        const cuentasActivos = data.cuentas
          .filter(c => c.tipo === 'activo')
          .reduce((acc,c) => acc + (parseFloat(c.valor) || 0), 0);
        dashboardMetrics.activos.textContent = `$ ${(activosProductos + cuentasActivos).toFixed(2)}`;
      }

      // Clear form container
      function clearFormContainer(){
        formContainer.innerHTML = '';
      }

      // Show error messages
      function showError(message){
        formContainer.innerHTML = `<p style="color:#dc2626;font-weight:700">${message}</p>`;
      }

      // Show success message
      function showSuccess(message){
        formContainer.innerHTML = `<p style="color:green;font-weight:700">${message}</p>`;
      }

      // Helper to create table HTML from array of objects and columns
      function createTable(dataArray, columns, caption){
        if(!Array.isArray(dataArray) || dataArray.length === 0) {
          return `<p>No hay datos disponibles.</p>`;
        }
        const thead = columns.map(col => `<th scope="col">${col.header}</th>`).join('');
        const tbody = dataArray.map(row => {
          return `<tr>` + columns.map(col => {
            if(col.format && typeof col.format === 'function'){
              return `<td>${col.format(row[col.key], row)}</td>`;
            }
            return `<td>${row[col.key] !== undefined ? row[col.key] : ''}</td>`;
          }).join('') + `</tr>`;
        }).join('');
        return `
          <table class="data-table">
            <caption>${caption}</caption>
            <thead><tr>${thead}</tr></thead>
            <tbody>${tbody}</tbody>
          </table>
        `;
      }

      // Load form or view content by name
      function loadForm(name){
        // Clear existing content and messages
        clearFormContainer();

        // Implement each form or view with full functionality and validation

        switch(name){
          case 'add-client':
            renderAddClientForm();
            break;
          case 'add-sale':
            renderAddSaleForm();
            break;
          case 'add-payment':
            renderAddPaymentForm();
            break;
          case 'add-provider':
            renderAddProviderForm();
            break;
          case 'add-purchase':
            renderAddPurchaseForm();
            break;
          case 'add-expense':
            renderAddExpenseForm();
            break;
          case 'add-product':
            renderAddProductForm();
            break;
          case 'inventory-list':
            renderInventoryList();
            break;
          case 'add-account':
            renderAddAccountForm();
            break;
          case 'list-accounts':
            renderListAccounts();
            break;
          case 'balance-general':
            renderBalanceGeneral();
            break;
          case 'estado-resultados':
            renderEstadoResultados();
            break;
          case 'flujo-efectivo':
            renderFlujoEfectivo();
            break;
          case 'cambios-patrimonio':
            renderCambiosPatrimonio();
            break;
          default:
            formContainer.innerHTML = '<p>Formulario no disponible.</p>';
        }

        formContainer.focus();
      }

      // Clients
      function renderAddClientForm(){
        formContainer.innerHTML = `
          <h2>Agregar Cliente</h2>
          <form id="form-add-client" aria-label="Formulario para agregar cliente" novalidate>
            <label for="client-name">Nombre del Cliente</label>
            <input type="text" id="client-name" name="client-name" required placeholder="Juan Pérez" />
            
            <label for="client-email">Correo Electrónico</label>
            <input type="email" id="client-email" name="client-email" required placeholder="ejemplo@correo.com" />
            
            <label for="client-phone">Teléfono</label>
            <input type="tel" id="client-phone" name="client-phone" placeholder="+54 9 11 1234 5678" />
            
            <button type="submit">Guardar Cliente</button>
          </form>
        `;

        const form = document.getElementById('form-add-client');

        form.addEventListener('submit', e => {
          e.preventDefault();
          if(!form.checkValidity()){
            form.reportValidity();
            return;
          }
          const newClient = {
            id: Date.now(),
            nombre: form['client-name'].value.trim(),
            email: form['client-email'].value.trim(),
            telefono: form['client-phone'].value.trim(),
          };
          data.clientes.push(newClient);
          saveData();
          updateDashboard();
          showSuccess('Cliente agregado correctamente.');
        });
      }

      // Sales (Venta)
      function renderAddSaleForm(){
        if(data.clientes.length === 0){
          showError('No hay clientes registrados. Agregue clientes primero.');
          return;
        }
        formContainer.innerHTML = `
          <h2>Registrar Venta</h2>
          <form id="form-add-sale" aria-label="Formulario para registrar venta" novalidate>
            <label for="sale-client">Cliente</label>
            <select id="sale-client" name="sale-client" required>
              <option value="" disabled selected>Seleccione un cliente</option>
              ${data.clientes.map(c => `<option value="${c.id}">${c.nombre}</option>`).join('')}
            </select>

            <label for="sale-amount">Monto</label>
            <input type="number" id="sale-amount" name="sale-amount" required min="0" step="any" placeholder="1000" />

            <label for="sale-date">Fecha</label>
            <input type="date" id="sale-date" name="sale-date" required value="${new Date().toISOString().slice(0,10)}" />

            <button type="submit">Registrar Venta</button>
          </form>
        `;

        const form = document.getElementById('form-add-sale');

        form.addEventListener('submit', e => {
          e.preventDefault();
          if(!form.checkValidity()){
            form.reportValidity();
            return;
          }
          const newSale = {
            id: Date.now(),
            clienteId: parseInt(form['sale-client'].value),
            monto: parseFloat(form['sale-amount'].value),
            fecha: form['sale-date'].value,
          };
          data.ventas.push(newSale);
          saveData();
          updateDashboard();
          showSuccess('Venta registrada correctamente.');
        });
      }

      // Payments from clients (Agregar Cobro)
      function renderAddPaymentForm(){
        if(data.clientes.length === 0){
          showError('No hay clientes registrados. Agregue clientes primero.');
          return;
        }
        formContainer.innerHTML = `
          <h2>Agregar Cobro</h2>
          <form id="form-add-payment" aria-label="Formulario para agregar cobro" novalidate>
            <label for="payment-client">Cliente</label>
            <select id="payment-client" name="payment-client" required>
              <option value="" disabled selected>Seleccione un cliente</option>
              ${data.clientes.map(c => `<option value="${c.id}">${c.nombre}</option>`).join('')}
            </select>

            <label for="payment-amount">Monto</label>
            <input type="number" id="payment-amount" name="payment-amount" required min="0" step="any" placeholder="500" />

            <label for="payment-date">Fecha</label>
            <input type="date" id="payment-date" name="payment-date" required value="${new Date().toISOString().slice(0,10)}" />

            <button type="submit">Agregar Cobro</button>
          </form>
        `;

        const form = document.getElementById('form-add-payment');

        form.addEventListener('submit', e => {
          e.preventDefault();
          if(!form.checkValidity()){
            form.reportValidity();
            return;
          }
          const newPayment = {
            id: Date.now(),
            clienteId: parseInt(form['payment-client'].value),
            monto: parseFloat(form['payment-amount'].value),
            fecha: form['payment-date'].value,
          };
          data.cobros.push(newPayment);
          saveData();
          updateDashboard();
          showSuccess('Cobro registrado correctamente.');
        });
      }

      // Providers (Agregar Proveedor)
      function renderAddProviderForm(){
        formContainer.innerHTML = `
          <h2>Agregar Proveedor</h2>
          <form id="form-add-provider" aria-label="Formulario para agregar proveedor" novalidate>
            <label for="provider-name">Nombre del Proveedor</label>
            <input type="text" id="provider-name" name="provider-name" required placeholder="Proveedor SA" />

            <label for="provider-contact">Contacto</label>
            <input type="text" id="provider-contact" name="provider-contact" placeholder="Nombre de contacto" />

            <button type="submit">Guardar Proveedor</button>
          </form>
        `;

        const form = document.getElementById('form-add-provider');

        form.addEventListener('submit', e => {
          e.preventDefault();
          if(!form.checkValidity()){
            form.reportValidity();
            return;
          }
          const newProvider = {
            id: Date.now(),
            nombre: form['provider-name'].value.trim(),
            contacto: form['provider-contact'].value.trim(),
          };
          data.proveedores.push(newProvider);
          saveData();
          updateDashboard();
          showSuccess('Proveedor agregado correctamente.');
        });
      }

      // Purchases (Registrar Compra)
      function renderAddPurchaseForm(){
        if(data.proveedores.length === 0){
          showError('No hay proveedores registrados. Agregue proveedores primero.');
          return;
        }
        formContainer.innerHTML = `
          <h2>Registrar Compra</h2>
          <form id="form-add-purchase" aria-label="Formulario para registrar compra" novalidate>
            <label for="purchase-provider">Proveedor</label>
            <select id="purchase-provider" name="purchase-provider" required>
              <option value="" disabled selected>Seleccione un proveedor</option>
              ${data.proveedores.map(p => `<option value="${p.id}">${p.nombre}</option>`).join('')}
            </select>

            <label for="purchase-amount">Monto</label>
            <input type="number" id="purchase-amount" name="purchase-amount" required min="0" step="any" placeholder="1500" />

            <label for="purchase-date">Fecha</label>
            <input type="date" id="purchase-date" name="purchase-date" required value="${new Date().toISOString().slice(0,10)}" />

            <button type="submit">Registrar Compra</button>
          </form>
        `;

        const form = document.getElementById('form-add-purchase');

        form.addEventListener('submit', e => {
          e.preventDefault();
          if(!form.checkValidity()){
            form.reportValidity();
            return;
          }
          const newPurchase = {
            id: Date.now(),
            proveedorId: parseInt(form['purchase-provider'].value),
            monto: parseFloat(form['purchase-amount'].value),
            fecha: form['purchase-date'].value,
          };
          data.compras.push(newPurchase);
          saveData();
          updateDashboard();
          showSuccess('Compra registrada correctamente.');
        });
      }

      // Payments to providers (Agregar Pago)
      function renderAddExpenseForm(){
        if(data.proveedores.length === 0){
          showError('No hay proveedores registrados. Agregue proveedores primero.');
          return;
        }
        formContainer.innerHTML = `
          <h2>Agregar Pago</h2>
          <form id="form-add-expense" aria-label="Formulario para agregar pago" novalidate>
            <label for="expense-provider">Proveedor</label>
            <select id="expense-provider" name="expense-provider" required>
              <option value="" disabled selected>Seleccione un proveedor</option>
              ${data.proveedores.map(p => `<option value="${p.id}">${p.nombre}</option>`).join('')}
            </select>

            <label for="expense-amount">Monto</label>
            <input type="number" id="expense-amount" name="expense-amount" required min="0" step="any" placeholder="700" />

            <label for="expense-date">Fecha</label>
            <input type="date" id="expense-date" name="expense-date" required value="${new Date().toISOString().slice(0,10)}" />

            <button type="submit">Agregar Pago</button>
          </form>
        `;

        const form = document.getElementById('form-add-expense');

        form.addEventListener('submit', e => {
          e.preventDefault();
          if(!form.checkValidity()){
            form.reportValidity();
            return;
          }
          const newExpense = {
            id: Date.now(),
            proveedorId: parseInt(form['expense-provider'].value),
            monto: parseFloat(form['expense-amount'].value),
            fecha: form['expense-date'].value,
          };
          data.pagos.push(newExpense);
          saveData();
          updateDashboard();
          showSuccess('Pago registrado correctamente.');
        });
      }

      // Products (Agregar Producto)
      function renderAddProductForm(){
        formContainer.innerHTML = `
          <h2>Agregar Producto</h2>
          <form id="form-add-product" aria-label="Formulario para agregar producto" novalidate>
            <label for="product-name">Nombre del Producto</label>
            <input type="text" id="product-name" name="product-name" required placeholder="Producto Ejemplo" />

            <label for="product-sku">SKU</label>
            <input type="text" id="product-sku" name="product-sku" placeholder="123ABC" />

            <label for="product-price">Precio</label>
            <input type="number" id="product-price" name="product-price" required min="0" step="any" placeholder="100" />

            <label for="product-stock">Stock</label>
            <input type="number" id="product-stock" name="product-stock" required min="0" step="1" placeholder="50" />

            <button type="submit">Agregar Producto</button>
          </form>
        `;

        const form = document.getElementById('form-add-product');

        form.addEventListener('submit', e => {
          e.preventDefault();
          if(!form.checkValidity()){
            form.reportValidity();
            return;
          }
          const newProduct = {
            id: Date.now(),
            nombre: form['product-name'].value.trim(),
            sku: form['product-sku'].value.trim(),
            precio: parseFloat(form['product-price'].value),
            stock: parseInt(form['product-stock'].value, 10),
          };
          data.productos.push(newProduct);
          saveData();
          updateDashboard();
          showSuccess('Producto agregado correctamente.');
        });
      }

      // Inventory List (Control Stock)
      function renderInventoryList(){
        if(data.productos.length === 0){
          showError('No hay productos registrados. Agregue productos primero.');
          return;
        }
        const columns = [
          {key: 'nombre', header: 'Nombre'},
          {key: 'sku', header: 'SKU'},
          {key: 'precio', header: 'Precio', format: val => `$ ${val.toFixed(2)}`},
          {key: 'stock', header: 'Stock'},
        ];
        formContainer.innerHTML = createTable(data.productos, columns, 'Inventario de Productos');
      }

      // Accounts (Agregar Cuenta)
      function renderAddAccountForm(){
        formContainer.innerHTML = `
          <h2>Agregar Cuenta Contable</h2>
          <form id="form-add-account" aria-label="Formulario para agregar cuenta contable" novalidate>
            <label for="account-name">Nombre de la Cuenta</label>
            <input type="text" id="account-name" name="account-name" required placeholder="Caja" />

            <label for="account-type">Tipo de Cuenta</label>
            <select id="account-type" name="account-type" required>
              <option value="" disabled selected>Seleccione...</option>
              <option value="activo">Activo</option>
              <option value="pasivo">Pasivo</option>
              <option value="patrimonio">Patrimonio</option>
              <option value="ingreso">Ingreso</option>
              <option value="gasto">Gasto</option>
            </select>

            <label for="account-value">Valor</label>
            <input type="number" id="account-value" name="account-value" required min="0" step="any" placeholder="0" />

            <button type="submit">Agregar Cuenta</button>
          </form>
        `;

        const form = document.getElementById('form-add-account');

        form.addEventListener('submit', e => {
          e.preventDefault();
          if(!form.checkValidity()){
            form.reportValidity();
            return;
          }
          const newAccount = {
            id: Date.now(),
            nombre: form['account-name'].value.trim(),
            tipo: form['account-type'].value,
            valor: parseFloat(form['account-value'].value),
          };
          data.cuentas.push(newAccount);
          saveData();
          updateDashboard();
          showSuccess('Cuenta agregada correctamente.');
        });
      }

      // List Accounts
      function renderListAccounts(){
        if(data.cuentas.length === 0){
          showError('No hay cuentas registradas. Agregue cuentas primero.');
          return;
        }
        const columns = [
          {key: 'nombre', header: 'Nombre'},
          {key: 'tipo', header: 'Tipo'},
          {key: 'valor', header: 'Valor', format: val => `$ ${val.toFixed(2)}`},
        ];
        formContainer.innerHTML = createTable(data.cuentas, columns, 'Listado de Cuentas Contables');
      }

      // Financial Reports (Placeholder aggregated mock data)

      function renderBalanceGeneral(){
        const totalActivos = data.productos.reduce((acc,p) => acc + (p.stock * p.precio), 0) +
          data.cuentas.filter(c => c.tipo === 'activo').reduce((acc,c) => acc + c.valor, 0);
        const totalPasivos = data.cuentas.filter(c => c.tipo === 'pasivo').reduce((acc,c) => acc + c.valor,0);
        const patrimonio = data.cuentas.filter(c => c.tipo === 'patrimonio').reduce((acc,c) => acc + c.valor,0);

        formContainer.innerHTML = `
          <h2>Balance General</h2>
          <table class="data-table">
            <caption>Balance General</caption>
            <thead>
              <tr><th>Cuenta</th><th>Monto</th></tr>
            </thead>
            <tbody>
              <tr><td>Activos Totales</td><td>$ ${totalActivos.toFixed(2)}</td></tr>
              <tr><td>Pasivos Totales</td><td>$ ${totalPasivos.toFixed(2)}</td></tr>
              <tr><td>Patrimonio</td><td>$ ${patrimonio.toFixed(2)}</td></tr>
              <tr><td><strong>Suma Pasivo + Patrimonio</strong></td><td>$ ${(totalPasivos+patrimonio).toFixed(2)}</td></tr>
            </tbody>
          </table>
          <p>Nota: Datos calculados de activos, pasivos y patrimonio registrados.</p>
        `;
      }

      function renderEstadoResultados(){
        const ingresos = data.cuentas.filter(c => c.tipo === 'ingreso').reduce((acc,c) => acc + c.valor, 0);
        const gastos = data.cuentas.filter(c => c.tipo === 'gasto').reduce((acc,c) => acc + c.valor, 0);
        const utilidadNeta = ingresos - gastos;

        formContainer.innerHTML = `
          <h2>Estado de Resultados</h2>
          <table class="data-table">
            <caption>Estado de Resultados</caption>
            <thead>
              <tr><th>Concepto</th><th>Monto</th></tr>
            </thead>
            <tbody>
              <tr><td>Ingresos</td><td>$ ${ingresos.toFixed(2)}</td></tr>
              <tr><td>Gastos</td><td>$ ${gastos.toFixed(2)}</td></tr>
              <tr><td><strong>Utilidad Neta</strong></td><td>$ ${utilidadNeta.toFixed(2)}</td></tr>
            </tbody>
          </table>
          <p>Nota: Basado en ingresos y gastos registrados en cuentas.</p>
        `;
      }

      function renderFlujoEfectivo(){
        const cobrosTotal = data.cobros.reduce((acc,c) => acc + c.monto,0);
        const pagosTotal = data.pagos.reduce((acc,c) => acc + c.monto,0);
        const flujoNeto = cobrosTotal - pagosTotal;

        formContainer.innerHTML = `
          <h2>Flujo de Efectivo</h2>
          <table class="data-table">
            <caption>Flujo de Efectivo</caption>
            <thead>
              <tr><th>Concepto</th><th>Monto</th></tr>
            </thead>
            <tbody>
              <tr><td>Cobros</td><td>$ ${cobrosTotal.toFixed(2)}</td></tr>
              <tr><td>Pagos</td><td>$ ${pagosTotal.toFixed(2)}</td></tr>
              <tr><td><strong>Flujo Neto</strong></td><td>$ ${flujoNeto.toFixed(2)}</td></tr>
            </tbody>
          </table>
          <p>Nota: Diferencia entre cobros y pagos registrados.</p>
        `;
      }

      function renderCambiosPatrimonio(){
        const patrimonioInicial = 0; // No historic, so zero
        const patrimonioActual = data.cuentas.filter(c => c.tipo === 'patrimonio').reduce((acc,c) => acc + c.valor, 0);

        formContainer.innerHTML = `
          <h2>Cambios de Patrimonio</h2>
          <p>Patrimonio inicial: $ ${patrimonioInicial.toFixed(2)}</p>
          <p>Patrimonio actual: $ ${patrimonioActual.toFixed(2)}</p>
          <p>Nota: No se dispone de datos históricos para cambios detallados.</p>
        `;
      }

      // Sidebar toggle
      toggleBtn.addEventListener('click', () => {
        const isCollapsed = sidebar.classList.toggle('collapsed');
        toggleBtn.setAttribute('aria-expanded', (!isCollapsed).toString());
        // Close all submenus when collapsed
        if(isCollapsed) {
          menuItems.forEach(item => {
            item.setAttribute('aria-expanded', 'false');
            const submenu = document.getElementById(item.dataset.target);
            if(submenu) {
              submenu.classList.remove('open');
              submenu.setAttribute('aria-hidden', 'true');
            }
          });
        }
      });

      // Menu item expand/collapse
      menuItems.forEach(item => {
        item.addEventListener('click', () => {
          const expanded = item.getAttribute('aria-expanded') === 'true';

          menuItems.forEach(other => {
            if(other !== item){
              other.setAttribute('aria-expanded', 'false');
              const otherSub = document.getElementById(other.dataset.target);
              if(otherSub){
                otherSub.classList.remove('open');
                otherSub.setAttribute('aria-hidden', 'true');
              }
            }
          });

          const targetSubmenu = document.getElementById(item.dataset.target);
          if(targetSubmenu){
            if(expanded){
              item.setAttribute('aria-expanded', 'false');
              targetSubmenu.classList.remove('open');
              targetSubmenu.setAttribute('aria-hidden', 'true');
            } else {
              item.setAttribute('aria-expanded', 'true');
              targetSubmenu.classList.add('open');
              targetSubmenu.setAttribute('aria-hidden', 'false');
            }
          }
        });
        // keyboard accessibility for menu items
        item.addEventListener('keydown', (e) => {
          if(e.key === 'Enter' || e.key === ' '){
            e.preventDefault();
            item.click();
          }
        });
      });

      // Submenu item form loading
      submenuItems.forEach(submenuItem => {
        submenuItem.addEventListener('click', () => {
          loadForm(submenuItem.dataset.form);
        });
        submenuItem.addEventListener('keydown', e => {
          if(e.key === 'Enter' || e.key === ' '){
            e.preventDefault();
            submenuItem.click();
          }
        });
      });

      // Initialize
      loadData();
      updateDashboard();

      // Focus main content on load
      const mainContent = document.querySelector('main.content');
      mainContent.focus();
    });
  </script>
</body>
</html>